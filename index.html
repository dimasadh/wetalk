<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Client</title>
</head>
<body>
<h1>WebSocket Client</h1>
<div>
    <input type="text" id="chatIdInput" placeholder="Enter chat ID">
</div>
<div>
    <input type="text" id="userIdInput" placeholder="Enter your user ID (UUID)">
    <button onclick="connect()">Connect</button>
</div>
<div>
    <input type="text" id="messageInput" placeholder="Enter your message">
    <button id="btnMessage" onclick="sendMessage()" disabled>Send</button>
</div>
<div id="messages"></div>

<script>
    let ws;

    function connect() {
        let userId = document.getElementById("userIdInput").value;
        if (!userId) {
            alert("Please enter a user ID");
            return;
        }

        ws = new WebSocket("ws://localhost:8080/ws/" + userId);

        ws.onopen = function() {
            console.log("Connected to WebSocket server");
            document.getElementById("btnMessage").disabled = false;
        };

        ws.onmessage = function(event) {
            let messageDisplay = document.getElementById("messages");

            // message = {"chatId": "...", "userName": "...", "message": "...", "timestamp": ...}
            let data = JSON.parse(event.data);
            let messageTime = new Date(data.timestamp);
            let messageElement = document.createElement("div");
            messageElement.textContent = `[${messageTime.toLocaleTimeString()}] ${data.userName}: ${data.message}`;
            messageDisplay.appendChild(messageElement);
        };

        ws.onclose = function() {
            console.log("WebSocket connection closed");
            document.getElementById("btnMessage").disabled = true;
        };

        ws.onerror = function(error) {
            console.error("WebSocket error:", error);
            document.getElementById("btnMessage").disabled = true;
        };
    }

    function sendMessage() {
        let input = document.getElementById("messageInput");
        let chatId = document.getElementById("chatIdInput").value;
        if (!chatId) {
            alert("Please enter a chat ID");
            return;
        }

        let payload = {
            "timestamp": Date.now(),
            "chatId": chatId,
            "message": input.value,
        };
        input.value = "";

        ws.send(JSON.stringify(payload));

        let messageDisplay = document.getElementById("messages");
        let messageElement = document.createElement("div");
        let messageTime = new Date(payload.timestamp);
        messageElement.textContent = `[${messageTime.toLocaleDateString()}] Me: ${payload.message}`;
        messageDisplay.appendChild(messageElement);
    }
</script>
</body>
</html>